name: Build and Deploy to GKE

on:
  push:
    branches:
      - "master"

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - uses: tale/kubectl-action@v1
        with:
          base64-kube-config: ${{ secrets.KUBE_CONFIG }}
          kubectl-version: v1.22.0
      - run: kubectl get pods

      # - uses: azure/setup-kubectl@v2.0
      #   with:
      #     version: "v1.24.1" # default is latest stable
      #   id: install

      # - name: Login to GCR
      #   uses: docker/login-action@v2
      #   with:
      #     registry: gcr.io
      #     username: _json_key
      #     password: ${{ secrets.GCP_GCR_KEY }}

      # - uses: azure/k8s-set-context@v2
      #   with:
      #     method: kubeconfig
      #     kubeconfig: ${{ secrets.KUBE_CONFIG }}

      # - name: Build and push
      #   run: |
      #     docker build -t gcr.io/rocket-346418/test:${{ github.sha }} .
      #     docker push gcr.io/rocket-346418/test:${{ github.sha }}
      #     sed -i -e 's/test:lastest/test:${{ github.sha }}/g' ./deployment.yaml
      #     kuberctl apply -f deployment.yaml
